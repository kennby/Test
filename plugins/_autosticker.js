import {sticker} from '../lib/sticker.js';

const handler = (m) => m;

handler.all = async function(m) {
  const chat = db.data.chats[m.chat];
  const user = db.data.users[m.sender];

  if (chat.autosticker && m.isGroup) {
    const q = m;
    let stiker = false;
    const mime = (q.msg || q).mimetype || q.mediaType || '';
    if (/webp/g.test(mime)) return;
    if (/image/g.test(mime)) {
      const img = await q.download?.();
      if (!img) return;
      stiker = await sticker(img, false, packname, author);
    } else if (/video/g.test(mime)) {
      if (/video/g.test(mime)) if ((q.msg || q).seconds > 8) return await m.reply(`*ð–¥¨à¹âˆ˜Ì¥âƒŸâ¸½âƒŸðŸ’žâž¤ ð—£ð—¼ð—¿ ð—³ð—®ð˜ƒð—¼ð—¿ ð—²ð—¹ ð˜ƒð—¶ð—±ð—²ð—¼ ð—»ð—¼ ð—±ð—²ð—¯ð—² ð—±ð—² ð—±ð˜‚ð—¿ð—®ð—¿ ð—ºð—®ð˜€ ð—±ð—² 7 ð˜€ð—²ð—´ð˜‚ð—»ð—±ð—¼ð˜€, ð—½ð—®ð—¿ð—® ð—¿ð—²ð—®ð—¹ð—¶ð˜‡ð—®ð—¿ ð˜‚ð—» ð˜€ð˜ð—¶ð—°ð—¸ð—²ð—¿ ð—®ð˜‚ð˜ð—¼ð—ºð—®ð˜ð—¶ð—°ð—¼ ð—²ð—» ð—ºð—®ð—»ð—±ð—®ð—¿ ð˜ƒð—¶ð—±ð—²ð—¼ð˜€, ð˜ð—¶ð—²ð—»ð—² ð—¾ð˜‚ð—² ð—°ð—¼ð—¿ð˜ð—®ð—¿ ð—²ð—¹ ð˜ƒð—¶ð—±ð—²ð—¼ ð—® 7 ð˜€ð—²ð—´ð˜‚ð—»ð—±ð—¼ð˜€.\n\nð–¥¨à¹âˆ˜Ì¥âƒŸâ¸½âƒŸðŸ’žâž¤ ð—£ð—®ð—¿ð—® ð—±ð—²ð˜€ð—®ð—°ð˜ð—¶ð˜ƒð—®ð—¿ ð—²ð˜€ð˜ð—® ð—¼ð—½ð—°ð—¶ð—¼ð—», ð—²ð˜€ð—°ð—¿ð—¶ð—¯ð—® ð—²ð—¹ ð—°ð—¼ð—ºð—®ð—»ð—±ð—¼: (#ðšðš’ðšœðšŠðš‹ðš•ðšŽ ðšŠðšžðšðš˜ðšœðšðš’ðšŒðš”ðšŽðš›) ð˜† ð—®ð˜€ð—¶ ð˜†ð—® ð—»ð—¼ ð—µð—®ð—¿ð—® ð˜€ð˜ð—¶ð—°ð—¸ð—²ð—¿ð˜€ ð—®ð˜‚ð˜ð—¼ð—ºð—®ð˜ð—¶ð—°ð—¼ð˜€.`);
      // await this.sendButton(m.chat, '*ð–¥¨à¹âˆ˜Ì¥âƒŸâ¸½âƒŸðŸ’žâž¤ ð—£ð—¼ð—¿ ð—³ð—®ð˜ƒð—¼ð—¿ ð—²ð—¹ ð˜ƒð—¶ð—±ð—²ð—¼ ð—»ð—¼ ð—±ð—²ð—¯ð—² ð—±ð—² ð—±ð˜‚ð—¿ð—®ð—¿ ð—ºð—®ð˜€ ð—±ð—² 7 ð˜€ð—²ð—´ð˜‚ð—»ð—±ð—¼ð˜€, ð—½ð—®ð—¿ð—® ð—¿ð—²ð—®ð—¹ð—¶ð˜‡ð—®ð—¿ ð˜‚ð—» ð˜€ð˜ð—¶ð—°ð—¸ð—²ð—¿ ð—®ð˜‚ð˜ð—¼ð—ºð—®ð˜ð—¶ð—°ð—¼ ð—²ð—» ð—ºð—®ð—»ð—±ð—®ð—¿ ð˜ƒð—¶ð—±ð—²ð—¼ð˜€, ð˜ð—¶ð—²ð—»ð—² ð—¾ð˜‚ð—² ð—°ð—¼ð—¿ð˜ð—®ð—¿ ð—²ð—¹ ð˜ƒð—¶ð—±ð—²ð—¼ ð—® 7 ð˜€ð—²ð—´ð˜‚ð—»ð—±ð—¼ð˜€.\n\nð–¥¨à¹âˆ˜Ì¥âƒŸâ¸½âƒŸðŸ’žâž¤ ð—£ð—®ð—¿ð—® ð—±ð—²ð˜€ð—®ð—°ð˜ð—¶ð˜ƒð—®ð—¿ ð—²ð˜€ð˜ð—® ð—¼ð—½ð—°ð—¶ð—¼ð—», ð—²ð˜€ð—°ð—¿ð—¶ð—¯ð—® ð—²ð—¹ ð—°ð—¼ð—ºð—®ð—»ð—±ð—¼: (#ðšðš’ðšœðšŠðš‹ðš•ðšŽ ðšŠðšžðšðš˜ðšœðšðš’ðšŒðš”ðšŽðš›) ð˜† ð—®ð˜€ð—¶ ð˜†ð—® ð—»ð—¼ ð—µð—®ð—¿ð—® ð˜€ð˜ð—¶ð—°ð—¸ð—²ð—¿ð˜€ ð—®ð˜‚ð˜ð—¼ð—ºð—®ð˜ð—¶ð—°ð—¼ð˜€.', wm, [['ðŸ’ž ð——ð—²ð˜€ð—®ð—°ð˜ð—¶ð˜ƒð—®ð—¿ ð—”ð˜‚ð˜ð—¼ð˜€ð˜ð—¶ð—°ð—¸ð—²ð—¿ð˜€ ðŸ’ž', '/disable autosticker']], m)
      const img = await q.download();
      if (!img) return;
      stiker = await sticker(img, false, packname, author);
    } else if (m.text.split(/\n| /i)[0]) {
      if (isUrl(m.text)) stiker = await sticker(false, m.text.split(/\n| /i)[0], packname, author);
      else return;
    }
    if (stiker) {
      await mconn.conn.sendFile(m.chat, stiker, null, {asSticker: true});
    }
  }
  return !0;
};
export default handler;

const isUrl = (text) => {
  return text.match(new RegExp(/^https?:\/\/(www\.)?[-a-zA-Z0-9@:%._+~#=]{1,256}\.[a-zA-Z0-9()]{1,6}\b([-a-zA-Z0-9()@:%_+.~#?&/=]*)(jpe?g|gif|png|mp4)/, 'gi'));
};
